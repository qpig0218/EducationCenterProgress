<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>教學中心 - 專案進度儀表板</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #f0f4f8;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .task-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .task-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* Style for the select dropdown */
        .filter-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1em;
            padding-right: 2rem;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="mb-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">教學中心 - 專案進度儀表板</h1>
                    <p class="text-gray-500 mt-1">即時追蹤所有進行中的專案與任務</p>
                </div>
                <div id="last-updated" class="text-sm text-gray-600 bg-white px-3 py-1 rounded-full shadow-sm mt-4 md:mt-0"></div>
            </div>
        </header>

        <!-- Filters -->
        <div class="mb-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 items-center bg-white p-4 rounded-lg shadow">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">狀態</label>
                <div class="flex flex-wrap gap-2">
                     <button data-filter="all" class="filter-btn-status flex-grow bg-blue-500 text-white px-3 py-1.5 rounded-md text-sm font-semibold shadow-sm">全部</button>
                     <button data-filter="Overdue" class="filter-btn-status flex-grow bg-white text-gray-700 px-3 py-1.5 rounded-md text-sm font-semibold shadow-sm">逾期</button>
                     <button data-filter="In Progress" class="filter-btn-status flex-grow bg-white text-gray-700 px-3 py-1.5 rounded-md text-sm font-semibold shadow-sm">進行中</button>
                     <button data-filter="Not Started" class="filter-btn-status flex-grow bg-white text-gray-700 px-3 py-1.5 rounded-md text-sm font-semibold shadow-sm">未開始</button>
                     <button data-filter="Completed" class="filter-btn-status flex-grow bg-white text-gray-700 px-3 py-1.5 rounded-md text-sm font-semibold shadow-sm">已完成</button>
                </div>
            </div>
             <div>
                <label for="group-filter" class="block text-sm font-medium text-gray-700 mb-1">業務類別</label>
                <select id="group-filter" class="filter-select w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5">
                    <option value="all">所有類別</option>
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>
            <div>
                <label for="owner-filter" class="block text-sm font-medium text-gray-700 mb-1">負責人</label>
                <select id="owner-filter" class="filter-select w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5">
                    <option value="all">所有負責人</option>
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>
            <div>
                 <label class="block text-sm font-medium text-gray-700 mb-1 invisible">操作</label>
                 <button id="reset-filters" class="w-full bg-gray-200 text-gray-800 px-4 py-2.5 rounded-lg text-sm font-semibold shadow-sm hover:bg-gray-300">重設篩選</button>
            </div>
        </div>

        <!-- Legend -->
        <div class="mb-4 flex flex-wrap items-center gap-x-6 gap-y-2 text-sm text-gray-600 px-2">
            <span class="font-medium text-gray-800">圖例說明：</span>
            <div class="flex items-center">
                <span class="h-3 w-3 rounded-full bg-green-500 mr-2 flex-shrink-0"></span>
                <span>已完成</span>
            </div>
            <div class="flex items-center">
                <span class="h-3 w-3 rounded-full bg-yellow-500 mr-2 flex-shrink-0"></span>
                <span>進行中</span>
            </div>
            <div class="flex items-center">
                <span class="h-3 w-3 rounded-full bg-blue-500 mr-2 flex-shrink-0"></span>
                <span>未開始</span>
            </div>
            <div class="flex items-center">
                <span class="h-3 w-3 rounded-full bg-red-500 mr-2 flex-shrink-0"></span>
                <span>已逾期</span>
            </div>
        </div>

        <!-- Task Board -->
        <main id="task-board" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Task cards will be inserted here by JavaScript -->
        </main>
        
        <!-- Empty State -->
        <div id="empty-state" class="hidden text-center py-16">
             <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                <path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h12a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2z" />
            </svg>
            <h3 class="mt-2 text-sm font-medium text-gray-900">沒有符合條件的任務</h3>
            <p class="mt-1 text-sm text-gray-500">請嘗試調整您的篩選條件或點擊「重設篩選」。</p>
        </div>
    </div>

    <script>
        // --- DATA INITIALIZATION ---
        const TODAY = new Date('2025-06-16');
        const tasks = [
            { group: '教學中心', task: '114年上半年教學平台滿意度調查', owner: '淑雅', dueDate: '2025-06-30', notes: '上半年底前完成' },
            { group: '教學中心', task: '院級/PGY導師教學績效考核', owner: '瑞穗, 曉琪, 嬿茹', dueDate: '2025-06-30', notes: '待月底回收陳送院方核定' },
            { group: '教學中心', task: '「奇美暖心角」畫作送達', owner: '詩芸', dueDate: '2025-06-19', notes: '畫作將送達本院' },
            { group: '教學中心', task: '【內部訓練】數位賦能系列課程', owner: '依玲', dueDate: '2025-07-29', notes: '系列課程，最終日為7/29' },
            { group: '教師培育中心', task: '114年度全院主治醫師教學績效評核', owner: '汶秀', dueDate: '2025-12-31', notes: '年度作業' },
            { group: '教師培育中心', task: '台南市醫師公會聯合旅遊活動', owner: '瑞穗', dueDate: '2025-08-31', notes: '地點：東勢林場' },
            { group: '教師培育中心', task: '聯合迎新餐會', owner: '瑞穗', dueDate: '2025-11-07', notes: '地點：總理大餐廳' },
            { group: '教師培育中心', task: '系列演講 (李玲嫻/野崎孝男/陳庭楷)', owner: '淑雅', dueDate: '2025-07-15', notes: '系列演講，最終日為7/15' },
            { group: '實習醫學生訓練', task: '國立中山大學TMAC評鑑', owner: '淑怡, 昱瑾', dueDate: '2025-12-09', notes: '評鑑日期: 12/09-12/12' },
            { group: '實習醫學生訓練', task: '中山醫學大學TMAC評鑑', owner: '淑怡, 昱瑾', dueDate: '2025-12-16', notes: '評鑑日期: 12/16-12/19' },
            { group: '實習醫學生訓練', task: '中山後醫TMAC自評報告回寄', owner: '淑怡, 昱瑾', dueDate: '2025-08-01' },
            { group: '實習醫學生訓練', task: '實習醫學生報到職前訓', owner: '淑怡, 昱瑾', dueDate: '2025-06-30' },
            { group: '實習醫學生訓練', task: 'UGY座談暨檢討餐會', owner: '淑怡, 昱瑾', dueDate: '2025-07-03' },
            { group: '畢業後一般醫學訓練', task: '處理PGY學員轉出入事宜', owner: '曉琪', dueDate: '2025-08-01', notes: '8月起生效'},
            { group: 'OSCE小組', task: '單領域OSCE教案徵稿', owner: '英云', dueDate: '2025-06-13', notes: '徵稿截止日' },
            { group: '動物實驗小組', task: '腹腔鏡模擬箱課程', owner: '惠津', dueDate: '2025-06-18' },
            { group: '動物實驗小組', task: '3D列印血管縫合課程', owner: '惠津', dueDate: '2025-06-26' },
            { group: '醫事人員教育', task: '導入線上會議紀錄簽核系統', owner: '宜婷, 詩芸', dueDate: '2025-05-31', notes: '5月起導入，視為已完成', status: 'Completed'},
            { group: '醫事人員教育', task: '與奇美博物館合作之醫學人文教育課程', owner: '宜婷, 詩芸', dueDate: '2025-07-18'},
            { group: '病歷審查小組', task: '第二季住院病歷行政審查', owner: '迎真, 盟淦', dueDate: '2025-06-30', notes: '4-6月' },
            { group: '行政表單數位化', task: 'Power Apps 設計教育訓練課程', owner: '依玲, 淑怡, 詩芸', dueDate: '2025-07-12', notes: '分兩天 (7/5, 7/12) 進行' }
        ];

        // --- FILTER & UI CONFIGURATION ---
        let currentFilters = {
            status: 'all',
            group: 'all',
            owner: 'all'
        };

        const statusConfig = {
            'Overdue': { text: '已逾期', color: 'bg-red-100', textColor: 'text-red-800', dot: 'bg-red-500' },
            'In Progress': { text: '進行中', color: 'bg-yellow-100', textColor: 'text-yellow-800', dot: 'bg-yellow-500' },
            'Not Started': { text: '未開始', color: 'bg-blue-100', textColor: 'text-blue-800', dot: 'bg-blue-500' },
            'Completed': { text: '已完成', color: 'bg-green-100', textColor: 'text-green-800', dot: 'bg-green-500' },
            'No Date': { text: '無日期', color: 'bg-gray-100', textColor: 'text-gray-800', dot: 'bg-gray-400' }
        };
        
        const groupColors = {};
        const availableColors = ['bg-pink-200', 'bg-purple-200', 'bg-indigo-200', 'bg-teal-200', 'bg-lime-200', 'bg-amber-200', 'bg-cyan-200', 'bg-fuchsia-200'];
        let colorIndex = 0;

        // --- CORE FUNCTIONS ---
        
        function getStatus(task) {
            if (task.status) return task.status;
            if (!task.dueDate) return 'No Date';
            const dueDate = new Date(task.dueDate);
            dueDate.setHours(23, 59, 59, 999);
            const daysDifference = (dueDate - TODAY) / (1000 * 60 * 60 * 24);
            if (daysDifference < 0) return 'Overdue';
            if (daysDifference <= 14) return 'In Progress';
            return 'Not Started';
        }
        
        /**
         * Renders task cards based on the currentFilters object.
         */
        function renderTasks() {
            const board = document.getElementById('task-board');
            const emptyState = document.getElementById('empty-state');
            board.innerHTML = '';

            const filteredTasks = tasks.filter(task => {
                const statusMatch = currentFilters.status === 'all' || getStatus(task) === currentFilters.status;
                const groupMatch = currentFilters.group === 'all' || task.group === currentFilters.group;
                const ownerMatch = currentFilters.owner === 'all' || task.owner.includes(currentFilters.owner);
                return statusMatch && groupMatch && ownerMatch;
            });

            if (filteredTasks.length === 0) {
                emptyState.classList.remove('hidden');
                board.classList.add('hidden');
            } else {
                emptyState.classList.add('hidden');
                board.classList.remove('hidden');
            }
            
            filteredTasks.sort((a, b) => {
                const dateA = a.dueDate ? new Date(a.dueDate) : new Date('9999-12-31');
                const dateB = b.dueDate ? new Date(b.dueDate) : new Date('9999-12-31');
                return dateA - dateB;
            });

            filteredTasks.forEach(task => {
                const status = getStatus(task);
                const config = statusConfig[status];
                if (!groupColors[task.group]) {
                    groupColors[task.group] = availableColors[colorIndex % availableColors.length];
                    colorIndex++;
                }
                const groupColor = groupColors[task.group];
                
                const card = `
                    <div class="task-card bg-white rounded-lg shadow-md border-l-4 ${config.dot.replace('bg-', 'border-')} p-4 flex flex-col justify-between">
                        <div>
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-xs font-semibold px-2.5 py-0.5 rounded-full ${config.color} ${config.textColor}">
                                    ${config.text}
                                </span>
                                <span class="text-xs font-medium text-gray-600 px-2 py-1 rounded-md ${groupColor}">
                                    ${task.group}
                                </span>
                            </div>
                            <h3 class="font-bold text-gray-800 text-lg mb-2">${task.task}</h3>
                            ${task.notes ? `<p class="text-sm text-gray-500 mb-3">${task.notes}</p>` : ''}
                        </div>
                        <div class="mt-4 pt-3 border-t border-gray-200">
                             <div class="flex items-center text-sm text-gray-600 mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 opacity-70"><path d="M12 2a5 5 0 1 0 5 5 5 5 0 0 0-5-5zM20 21a8 8 0 1 0-16 0"/></svg>
                                <strong>負責人：</strong><span class="ml-1">${task.owner}</span>
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 opacity-70"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/></svg>
                                <strong>截止日：</strong><span class="ml-1">${task.dueDate ? task.dueDate.replace(/-/g, '/') : '未指定'}</span>
                            </div>
                        </div>
                    </div>
                `;
                board.innerHTML += card;
            });
        }
        
        /**
         * Populates the filter dropdowns with unique values from tasks.
         */
        function populateFilters() {
            const groupFilter = document.getElementById('group-filter');
            const ownerFilter = document.getElementById('owner-filter');
            
            const groups = [...new Set(tasks.map(task => task.group))];
            const owners = [...new Set(tasks.flatMap(task => task.owner.split(',').map(name => name.trim())))];
            
            groups.sort().forEach(group => {
                groupFilter.innerHTML += `<option value="${group}">${group}</option>`;
            });

            owners.sort().forEach(owner => {
                ownerFilter.innerHTML += `<option value="${owner}">${owner}</option>`;
            });
        }
        
        /**
         * Sets up all event listeners for filter controls.
         */
        function setupEventListeners() {
            // Status filter buttons
            const statusButtons = document.querySelectorAll('.filter-btn-status');
            statusButtons.forEach(button => {
                button.addEventListener('click', () => {
                    statusButtons.forEach(btn => {
                        btn.classList.remove('bg-blue-500', 'text-white');
                        btn.classList.add('bg-white', 'text-gray-700');
                    });
                    button.classList.add('bg-blue-500', 'text-white');
                    button.classList.remove('bg-white', 'text-gray-700');
                    currentFilters.status = button.dataset.filter;
                    renderTasks();
                });
            });

            // Dropdown filters
            document.getElementById('group-filter').addEventListener('change', (e) => {
                currentFilters.group = e.target.value;
                renderTasks();
            });

            document.getElementById('owner-filter').addEventListener('change', (e) => {
                currentFilters.owner = e.target.value;
                renderTasks();
            });

            // Reset button
            document.getElementById('reset-filters').addEventListener('click', () => {
                currentFilters = { status: 'all', group: 'all', owner: 'all' };
                document.getElementById('group-filter').value = 'all';
                document.getElementById('owner-filter').value = 'all';
                document.querySelector('.filter-btn-status[data-filter="all"]').click(); // Simulate click to reset style
                renderTasks();
            });
        }

        function updateTimestamp() {
            const timestampEl = document.getElementById('last-updated');
            const now = new Date();
            const formattedDate = `${now.getFullYear()}/${(now.getMonth() + 1).toString().padStart(2, '0')}/${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            timestampEl.textContent = `最後更新：${formattedDate}`;
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            populateFilters();
            renderTasks();
            setupEventListeners();
            updateTimestamp();
        });

    </script>

</body>
</html>
